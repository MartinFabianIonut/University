{"version":3,"sources":["webpack:///webpack/bootstrap 078ed2de7e34f3c5e76f","webpack:///./src/index.js","webpack:///external \"http\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-cors\"","webpack:///external \"koa-router\"","webpack:///external \"ws\"","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///external \"regenerator-runtime\""],"names":["Koa","require","app","server","createServer","callback","WebSocket","wss","Server","Router","cors","bodyparser","use","ctx","next","start","Date","ms","console","log","method","url","response","status","Question","i","id","text","options","Array","keys","map","j","indexCorrectOption","questions","Promise","setTimeout","resolve","router","post","request","body","token","questionIds","q","get","parseInt","params","length","broadcast","data","clients","forEach","client","readyState","OPEN","send","JSON","stringify","payload","nextIndex","setInterval","question","routes","allowedMethods","listen"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 078ed2de7e34f3c5e76f","const Koa = require('koa');\r\nconst app = new Koa();\r\nconst server = require('http').createServer(app.callback());\r\nconst WebSocket = require('ws');\r\nconst wss = new WebSocket.Server({ server });\r\nconst Router = require('koa-router');\r\nconst cors = require('koa-cors');\r\nconst bodyparser = require('koa-bodyparser');\r\n\r\napp.use(bodyparser());\r\napp.use(cors());\r\n\r\napp.use(async function (ctx, next) {\r\n  const start = new Date();\r\n  await next();\r\n  const ms = new Date() - start;\r\n  console.log(`${ctx.method} ${ctx.url} ${ctx.response.status} - ${ms}ms`);\r\n});\r\n\r\nfunction Question(i) {\r\n  this.id = i;\r\n  this.text = `${i} + ${i} = ?`;\r\n  this.options = [...Array(4).keys()].map(j => 2 * i - j);\r\n  this.indexCorrectOption = 0;\r\n}\r\n\r\nconst questions = [...Array(3).keys()].map(i => new Question(i));\r\n\r\napp.use(async (ctx, next) => {\r\n  await new Promise(resolve => {\r\n    setTimeout(resolve, 1000);\r\n  });\r\n  await next();\r\n});\r\n\r\nconst router = new Router();\r\n\r\nrouter.post('/auth', ctx => {\r\n  const id = ctx.request.body.id;\r\n  if (!id) {\r\n    ctx.response.status = 400;\r\n  } else {\r\n    ctx.response.body = { token: id, questionIds: questions.map(q => q.id) };\r\n    ctx.response.status = 201;\r\n  }\r\n});\r\n\r\nrouter.get('/question/:id', ctx => {\r\n  const id = parseInt(ctx.params.id);\r\n  if (id < 0 || id >= questions.length) {\r\n    ctx.response.status = 404;\r\n  } else {\r\n    ctx.response.status = 200;\r\n    ctx.response.body = questions[id];\r\n  }\r\n});\r\n\r\nconst broadcast = (data) =>\r\n  wss.clients.forEach((client) => {\r\n    if (client.readyState === WebSocket.OPEN) {\r\n      client.send(JSON.stringify({ payload: data }));\r\n    }\r\n  });\r\n\r\nlet nextIndex = questions.length;\r\n\r\nsetInterval(() => {\r\n  const question = new Question(nextIndex++);\r\n  console.log(`broadcast ${question.text}`);\r\n  broadcast(question);\r\n}, 10000);\r\n\r\napp.use(router.routes());\r\napp.use(router.allowedMethods());\r\n\r\nserver.listen(3000);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 1\n// module chunks = 0 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 2\n// module chunks = 0 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 3\n// module chunks = 0 0","module.exports = require(\"koa-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-cors\"\n// module id = 4\n// module chunks = 0 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 5\n// module chunks = 0 0","module.exports = require(\"ws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ws\"\n// module id = 6\n// module chunks = 0 0","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 8\n// module chunks = 0 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 9\n// module chunks = 0 0"],"sourceRoot":""}